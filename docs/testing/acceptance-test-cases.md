# MVP 受け入れテストケース

## 概要

Wedding Smile Catcher のMVPリリース前に実施する受け入れテストケース一覧。

## テスト環境

- **LINE Bot**: テスト用チャネル
- **Firebase**: 本番環境（テストイベントを作成）
- **ブラウザ**: Chrome (最新版)、Safari (最新版)
- **デバイス**: PC、スマートフォン（iOS/Android）

---

## 1. LINE Bot フロー

### 1.1 ユーザー登録

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| L-001 | 新規ユーザー登録 | 1. 友だち追加後、初回メッセージでテキスト「テスト太郎」を送信 | 登録完了メッセージが返信される |
| L-002 | 名前更新 | 1. 登録済みユーザーがテキスト「テスト花子」を送信 | 名前更新完了メッセージが返信される |
| L-003 | 空メッセージ | 1. 空白のみのテキストを送信 | エラーメッセージが返信される |

### 1.2 画像投稿・スコアリング

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| L-010 | 笑顔写真投稿 | 1. 登録済みユーザーが笑顔の写真を送信 | スコアとAIコメントが返信される |
| L-011 | 複数人笑顔写真 | 1. 複数人が笑顔で写っている写真を送信 | 人数に応じた高スコアが返信される |
| L-012 | 笑顔なし写真 | 1. 無表情の写真を送信 | 低スコアが返信される |
| L-013 | 類似画像ペナルティ | 1. 同じ構図の写真を連続で2枚送信 | 2枚目は「類似画像」として1/3ペナルティが適用される |
| L-014 | 未登録ユーザー投稿 | 1. 名前未登録の状態で画像を送信 | 名前登録を促すメッセージが返信される |
| L-015 | 処理中表示 | 1. 画像を送信 | ローディングアニメーションが表示される |

### 1.3 同意フロー

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| L-020 | 初回同意 | 1. 新規ユーザーが初めて画像を送信 | 同意確認メッセージが表示される |
| L-021 | 同意後投稿 | 1. 同意ボタンを押下後、再度画像を送信 | 通常通りスコアリングされる |

---

## 2. ランキング画面 (index.html)

### 2.1 基本表示

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| R-001 | 初期表示 | 1. ランキング画面にアクセス | Top 3のランキングが表示される |
| R-002 | 1位表示 | 1. ランキング画面を確認 | 1位は大きく表示され、AIコメントが表示される |
| R-003 | 2-3位表示 | 1. ランキング画面を確認 | 2-3位は横並びで表示される |
| R-004 | 画像なし状態 | 1. 画像が0件の状態でアクセス | 適切な空状態が表示される |
| R-005 | QRコード表示 | 1. 画面右下を確認 | 参加用QRコードが表示される（140x140px） |

### 2.2 リアルタイム更新

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| R-010 | 新規投稿反映 | 1. ランキング画面を開いた状態で、別端末から画像を投稿 | ランキングがリアルタイムで更新される |
| R-011 | スコア更新 | 1. スコアリング完了時 | 順位が自動で再計算される |

### 2.3 スライドショーモード

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| R-020 | スライドショー切替 | 1. 「スライドショー」ボタンをクリック | フォトウォール表示に切り替わる |
| R-021 | ランキング切替 | 1. スライドショー表示中に「ランキング」ボタンをクリック | ランキング表示に戻る |

### 2.4 最終結果モード

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| R-030 | 最終結果表示 | 1. 「最終結果」ボタンをクリック 2. オーバーレイで「結果を見る」をクリック | アニメーション後、Top 10ランキングが表示される |
| R-031 | 4-10位表示 | 1. 最終結果モードで確認 | 4-10位がリスト形式で表示される |

### 2.5 設定モーダル

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| R-040 | モーダル開閉 | 1. ⚙️ボタンをクリック 2. ×ボタンをクリック | モーダルが開閉する |
| R-041 | 画像一括ダウンロード | 1. 「投稿画像を一括ダウンロード」をクリック | ZIP形式で全画像がダウンロードされる |
| R-042 | QRコードダウンロード | 1. 「参加用QRコードをダウンロード」をクリック | QRコード画像がダウンロードされる |
| R-043 | データ削除 | 1. 「データを削除」をクリック 2. 確認モーダルで「削除する」をクリック | 投稿画像が論理削除される |
| R-044 | データ削除キャンセル | 1. 「データを削除」をクリック 2. 「キャンセル」をクリック | 削除されずモーダルが閉じる |

---

## 3. 管理画面 (admin.html)

### 3.1 認証

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| A-001 | ログイン成功 | 1. 登録済みメールアドレスとパスワードを入力 2. ログインボタンをクリック | ダッシュボードが表示される |
| A-002 | ログイン失敗 | 1. 誤ったパスワードを入力 2. ログインボタンをクリック | エラーメッセージが表示される |
| A-003 | 新規登録 | 1. Sign Upタブに切替 2. 必要情報を入力 3. Create Account | アカウントが作成される（is_admin: false） |
| A-004 | ログアウト | 1. Logoutボタンをクリック | ログイン画面に戻る |

### 3.2 Images タブ

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| A-010 | 画像一覧表示 | 1. Imagesタブをクリック | 全画像がテーブル形式で表示される |
| A-011 | イベントフィルター | 1. イベントフィルターで特定イベントを選択 | そのイベントの画像のみ表示される |
| A-012 | 画像選択 | 1. 複数画像のチェックボックスを選択 | 選択数がボタンに反映される |
| A-013 | 全選択 | 1. Select Allボタンをクリック | 表示中の全画像が選択される |
| A-014 | 画像ダウンロード | 1. 画像を選択 2. Downloadボタンをクリック | 選択画像がZIPでダウンロードされる |
| A-015 | 画像削除 | 1. 画像を選択 2. Delete Selectedをクリック 3. 確認ダイアログでDelete | 選択画像が削除される |

### 3.3 Users タブ

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| A-020 | ユーザー一覧表示 | 1. Usersタブをクリック | 全ユーザーがテーブル形式で表示される |
| A-021 | ユーザー削除 | 1. ユーザーを選択 2. Delete Selectedをクリック 3. 確認 | 選択ユーザーが削除される |

### 3.4 Events タブ

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| A-030 | イベント一覧表示 | 1. Eventsタブをクリック | 全イベントがカード形式で表示される |
| A-031 | イベント作成 | 1. Create New Eventをクリック 2. 名前と日付を入力 3. Createをクリック | 新規イベントが作成される（status: draft） |
| A-032 | イベントコード表示 | 1. イベントカードを確認 | フルのイベントコードが表示される |
| A-033 | ステータス変更 | 1. ステータスバッジをクリック 2. ドロップダウンから新ステータスを選択 | ステータスが更新される |
| A-034 | Draft→Active | 1. Draftイベントを Activeに変更 | ステータスが Active になり、参加可能になる |
| A-035 | Active→Archived | 1. Activeイベントを Archivedに変更 | ステータスが Archived になり、参加不可になる |
| A-036 | QRコード表示 | 1. QR Codeボタンをクリック | QRコードモーダルが表示される |
| A-037 | Deep Link コピー | 1. QRモーダルでCopyボタンをクリック | Deep Link URLがクリップボードにコピーされる |
| A-038 | QRコードダウンロード | 1. QRモーダルでDownloadボタンをクリック | QRコード画像がダウンロードされる |
| A-039 | Ranking URL表示 | 1. Ranking URLボタンをクリック | ランキングURLがコピーされる |
| A-040 | イベント削除 | 1. イベントを選択 2. Delete Selectedをクリック 3. 確認 | イベントが削除される |

### 3.5 Accounts タブ

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| A-050 | アカウント一覧 | 1. Accountsタブをクリック | 全アカウントが表示される（Email, Admin, Created At） |
| A-051 | Admin権限確認 | 1. 一覧を確認 | is_admin: true/false が正しく表示される |

### 3.6 Statistics タブ

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| A-060 | 統計表示 | 1. Statisticsタブをクリック | 基本統計が表示される |
| A-061 | イベントフィルター | 1. イベントフィルターで特定イベントを選択 | そのイベントの統計が表示される |
| A-062 | Top 10 表示 | 1. Overall Top 10テーブルを確認 | 上位10件が画像付きで表示される |
| A-063 | 時間帯分布 | 1. Hourly Distributionチャートを確認 | 投稿の時間帯分布が表示される |

---

## 4. インフラ・バックエンド

### 4.1 Cloud Functions

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| I-001 | Webhook応答時間 | 1. 画像送信からスコア返信までの時間を計測 | 30秒以内に返信される |
| I-002 | 同時リクエスト | 1. 複数端末から同時に画像を送信（5件） | 全て正常に処理される |
| I-003 | エラーハンドリング | 1. 不正な画像形式を送信 | 適切なエラーメッセージが返される |

### 4.2 署名付きURL

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| I-010 | URL生成 | 1. 新規画像投稿後、Firestoreを確認 | storage_url と storage_url_expires_at が設定される |
| I-011 | URL有効期限 | 1. 生成された署名付きURLの有効期限を確認 | 1時間後に設定されている |
| I-012 | 画像表示 | 1. ランキング画面で画像表示を確認 | 署名付きURLで画像が正常に表示される |

### 4.3 Firestore

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| I-020 | データ整合性 | 1. 投稿後、images, users, rankings コレクションを確認 | 全コレクションにデータが正しく保存される |
| I-021 | リアルタイム | 1. Firestoreコンソールでデータ変更 | フロントエンドにリアルタイム反映される |

---

## 5. セキュリティ

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| S-001 | 未認証アクセス | 1. ログアウト状態で管理画面URLに直接アクセス | ログイン画面にリダイレクトされる |
| S-002 | 非管理者アクセス | 1. is_admin: false のアカウントでログイン | ダッシュボードは表示されるが、アクション制限される |
| S-003 | Cloud Storage直接アクセス | 1. バケット公開URLに直接アクセス | アクセス拒否される（署名付きURLのみ有効） |

---

## 6. モバイル対応

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| M-001 | ランキング画面（スマホ） | 1. スマートフォンでランキング画面にアクセス | レスポンシブ表示される |
| M-002 | 管理画面（スマホ） | 1. スマートフォンで管理画面にアクセス | 基本操作が可能（テーブルは横スクロール） |

---

## 7. エッジケース

| ID | テストケース | 手順 | 期待結果 |
|----|-------------|------|----------|
| E-001 | 長い名前 | 1. 50文字の名前で登録 | 正常に登録され、UIで適切に省略表示される |
| E-002 | 特殊文字名前 | 1. 絵文字を含む名前で登録 | 正常に登録・表示される |
| E-003 | 大きな画像 | 1. 10MB以上の高解像度画像を送信 | リサイズされて正常に処理される |
| E-004 | 同点スコア | 1. 同一スコアの画像が複数ある状態を確認 | 投稿時刻順で順位が決まる |

---

## テスト実施記録

| 日付 | 実施者 | テスト範囲 | 結果 | 備考 |
|------|--------|-----------|------|------|
| | | | | |

## 不具合一覧

| ID | 発見日 | テストID | 概要 | ステータス | 修正日 |
|----|--------|----------|------|-----------|--------|
| | | | | | |
