# MVP機能定義

最初の一般公開リリース（MVP）に含める機能と、含めない機能を定義する。

最終更新: 2026-01-26

---

## 前提

- ターゲット: 結婚式を控えるカップル（B2C）
- 価格: 15,000円/イベント
- 販売: Phase 1は知人紹介、Phase 2はココナラ
- 当日サポートなし、事前テスト必須

---

## 1. 既存機能（実装済み）

### ゲスト向け（LINE Bot）

| 機能 | 状態 | MVP | 備考 |
|------|------|-----|------|
| LINE Bot友達追加 → 登録ガイド表示 | ✅ | ○ | |
| テキストメッセージで名前登録 | ✅ | ○ | |
| 画像投稿 → Cloud Storageに保存 | ✅ | ○ | |
| スコアリング（Vision API + Gemini + Average Hash） | ✅ | ○ | |
| スコア結果をLINEで返信 | ✅ | ○ | |
| ヘルプコマンド | ✅ | ○ | |
| 類似画像ペナルティ通知 | ✅ | ○ | |

### ランキング表示（フロントエンド）

| 機能 | 状態 | MVP | 備考 |
|------|------|-----|------|
| 直近15枚のリアルタイムランキング（Top 3） | ✅ | ○ | |
| スライドショーモード（最新30枚散りばめ表示） | ✅ | ○ | |
| 自動モード切り替え（ランキング⇔スライドショー） | ✅ | ○ | |
| 最終結果発表モード（全体Top 10、ユニークユーザー） | ✅ | ○ | |
| 紙吹雪エフェクト | ✅ | ○ | |
| event_id URLパラメータ対応 | ✅ | ○ | |

### 管理画面

| 機能 | 状態 | MVP | 備考 |
|------|------|-----|------|
| パスワード認証 | ✅ | △ | Firebase Auth に置き換え |
| 画像一覧・削除 | ✅ | ○ | |
| ユーザー一覧・削除 | ✅ | ○ | |
| イベント一覧・削除 | ✅ | ○ | |
| 統計表示 | ✅ | ○ | |
| イベントフィルター | ✅ | ○ | |

### インフラ・運用

| 機能 | 状態 | MVP | 備考 |
|------|------|-----|------|
| Terraform によるインフラ管理 | ✅ | ○ | |
| CLIでのイベント作成 | ✅ | △ | セルフサービス化が必要 |
| CLIでのイベント切り替え | ✅ | △ | マルチテナント化で不要に |
| データエクスポート / ダウンロード | ✅ | △ | shell scriptのみ。管理画面UIからのダウンロード機能が必要 |
| GitHub Actions CI/CD | ✅ | ○ | |

---

## 2. MVPで追加が必要な機能

### 必須（これがないとサービスとして成立しない）

#### 2.1 マルチテナント対応

| 機能 | 説明 |
|------|------|
| イベントコードによるゲスト紐付け | `JOIN {event_code}` メッセージでイベントに参加（event_codeはUUID v4） |
| CURRENT_EVENT_ID の廃止 | webhook でイベントコードから動的にevent_idを解決 |
| 複数イベントの同時稼働 | Cloud Functions が複数イベントを並行処理 |

詳細: `docs/planning/multi-tenant-design.md`

#### 2.2 顧客アカウント管理

| 機能 | 説明 |
|------|------|
| 顧客登録（メール + パスワード） | Firebase Authentication |
| ログイン / ログアウト | |
| 管理画面のアクセス制御 | 自分のイベントのみ閲覧・操作可能 |

#### 2.3 セルフサービスでのイベント作成

| 機能 | 説明 |
|------|------|
| イベント作成フォーム | イベント名、日付、テーマ（オプション） |
| イベントコード自動生成 | ランダムで一意のコード |
| ディープリンクQRコード生成 | ゲスト配布用 |
| ランキング画面URL発行 | `xxx.web.app?event_id=...` |

#### 2.4 事前テストフロー

| 機能 | 説明 |
|------|------|
| テスト投稿機能 | 顧客自身がテスト投稿できる |
| テスト完了チェック | テスト投稿が成功したことを確認 |
| テストデータ削除 | テスト後に簡単にリセット |

#### 2.5 管理画面からの画像一括ダウンロード

| 機能 | 説明 |
|------|------|
| 画像一括ダウンロード（UI） | 管理画面からイベントの全画像をダウンロード |

現状はshell scriptによる簡易実装のみ。顧客がセルフサービスで利用できるUI化が必要。

#### 2.6 利用規約・プライバシーポリシー

| 機能 | 説明 |
|------|------|
| 利用規約ページ | サービス利用条件 |
| プライバシーポリシーページ | 個人情報（顔画像含む）の取り扱い |
| 同意フロー | アカウント作成時に同意を取得 |

---

### 重要（サービス品質に直結するが、Phase 2でも許容）

#### 2.7 決済機能

| 機能 | 説明 | MVP対応 |
|------|------|---------|
| ココナラ決済 | ココナラのプラットフォーム決済を利用 | Phase 2 |

**MVP時の代替**: Phase 1（知人紹介）は銀行振込 or 手渡し。Phase 2以降はココナラの決済を利用。Stripe等の自前決済は導入しない方針。

#### 2.8 バイラル施策

| 機能 | 説明 | MVP対応 |
|------|------|---------|
| ランキング画面にロゴ表示 | 控えめにサービス名 | MVP |
| イベント終了後LINE通知 | サービス紹介メッセージ | MVP |

#### 2.9 監視・アラート

| 機能 | 説明 | MVP対応 |
|------|------|---------|
| Cloud Monitoring設定 | エラー率、レイテンシ監視 | MVP |
| アラート通知 | 異常時にメール通知 | MVP |

---

## 3. MVPに含めない機能

| 機能 | 理由 | 将来の可能性 |
|------|------|-------------|
| 自前決済（Stripe等） | ココナラ/振込で十分。導入しない方針 | 採用しない |
| カスタムドメイン | コスト削減のためデフォルトドメイン | Phase 3 |
| テーマカラーカスタマイズ | オーバースコープ | Phase 3 |
| 多言語対応 | 日本語のみで十分 | 需要次第 |
| イベント後レポート（PDF） | オーバースコープ | 需要次第 |
| 紹介割引コード | Phase 3以降 | Phase 3 |
| SNSシェア機能 | プライバシー配慮で不採用 | 採用しない |

---

## 4. ユーザーフロー（MVP）

### 顧客（カップル）のフロー

```
1. アカウント作成（メール + パスワード）
   └── 利用規約・プライバシーポリシーに同意
2. イベント作成
   ├── イベント名、日付を入力
   ├── イベントコードが自動生成
   ├── ディープリンクQRコードが発行
   └── ランキング画面URLが発行
   ※ この時点ではstatus: draft（ゲスト参加不可）
3. 支払い → 運営者がイベントを有効化（status: active）
4. 事前テスト（1週間前まで）
   ├── 自分のスマホでQRコード読み取り
   ├── テスト投稿 → スコア確認
   ├── ランキング画面の表示確認
   └── テストデータ削除
5. 当日
   ├── 受付でQRコード付き説明書を配布
   ├── スクリーンにランキング画面を表示
   └── ゲストが写真を投稿
6. イベント終了後
   └── 管理画面からデータダウンロード（画像一括DL）
```

### ゲストのフロー

```
1. 受付でQRコード付き説明書を受け取る
2. QRコードをスキャン → LINE Bot追加
3. 自動入力された「JOIN {event_code}」を送信
4. 名前（フルネーム）を送信 → 登録完了
5. 笑顔の写真を投稿
6. AIがスコアリング → 結果がLINEで返信
7. スクリーンでリアルタイムランキングを確認
```

---

## 5. MVPリリース判定基準

以下がすべて満たされた場合にリリース可能:

- [ ] マルチテナント対応完了（複数イベント同時稼働）
- [ ] 顧客アカウント管理（Firebase Auth）実装
- [ ] セルフサービスでのイベント作成が可能
- [ ] 事前テストフローが動作
- [ ] 利用規約・プライバシーポリシーのページが公開
- [ ] ランキング画面にサービスロゴが表示
- [ ] イベント終了後LINE通知が動作
- [ ] 管理画面から画像一括ダウンロードが可能
- [ ] Cloud Monitoring のアラート設定済み
- [ ] 知人1-2名で実際に使用して問題なし
